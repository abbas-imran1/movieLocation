<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POC - Core Logic API</title>
</head>
<body>      
        <form id="pocForm" style="text-align: center" action="/upload" enctype="multipart/form-data" method="post">
        <h2>POC - Core Logic API </h2><br/>
            <label for="streetAddress">Street Address</label>
          <input type="text" id="streetAddress" name="streetAddress" /><br/><br/>      
          <label for="zip">Zip Code</label>
          <input type="text" id="zip" name="zip" /><br/><br/>
          <button type="submit">Submit</button><br/><br/>
          <img hidden id="spinner" src="https://res.cloudinary.com/dflulaosf/image/upload/v1630314537/assets/spinner_zispi9.gif" />
        </form>
        <div id="example" style="text-align: center;">Example:- 5300 WHITESBORO CT , 27540</div>
        <div id="message" style="text-align: center; color: red; margin-top: 10px; font-weight: bold;"></div>
        <div style="text-align: center;">
            <div id="apn"></div>
            <div id="city"></div>
            <div id="lat"></div>
            <div id="lng"></div>
        </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
        const url = 'https://api-prod.corelogic.com/';
        const form = document.getElementById('pocForm');
        form.addEventListener("submit", function (event) {
            // stop form submission
            event.preventDefault();
            const addr = document.getElementById('streetAddress').value;
            const zip = document.getElementById('zip').value;
            if (addr == '') {
                document.getElementById('message').innerHTML = "Please enter Street Address first";
                return;
            } else if (zip == '') {
                document.getElementById('message').innerHTML = "Please enter a Zip code to proceed further";
                return;
            } else {
                document.getElementById('message').innerHTML = "";
                document.getElementById('example').innerHTML = "";
                const spinner = document.getElementById("spinner");
                spinner.removeAttribute('hidden');
                const address = document.getElementById('streetAddress').value;
                const zip = document.getElementById('zip').value;
                console.log('called');
                const data = {
                    address: address,
                    zip: zip
                }
                fetch(`https://secureapimanagement.azure-api.net/coreLoginApi/GetData`, {
                    method: 'POST',
                    headers: {
                        'Access-Control-Allow-Origin':'*'
                    }, 
                    body: JSON.stringify(data)
                })
                .then(response => response.json())
                .then(data => {
                    const spinner = document.getElementById("spinner");
                    spinner.hidden = true;
                    const apiData = data['data'][0]
                    document.getElementById('apn').innerHTML = `Apn:  ${apiData.apn}`
                    document.getElementById('city').innerHTML = `City:  ${apiData.city}`
                    document.getElementById('lat').innerHTML = `Latitude:  ${apiData.latitude}`
                    document.getElementById('lng').innerHTML = `Longitude:  ${apiData.longitude}`
                }
                ).catch(e => {
                    console.log(e);
                    document.getElementById('message').innerHTML = e;
                })
        }
        });   
</script>
</html>